[
  {
    "method": "org.apache.commons.lang.Entities.doUnescape",
    "doc": "/**\n     * Underlying unescape method that allows the optimisation of not starting from the 0 index again.\n     *\n     * @param writer\n     *            The <code>Writer</code> to write the results to; assumed to be non-null.\n     * @param str\n     *            The source <code>String</code> to unescape; assumed to be non-null.\n     * @param firstAmp\n     *            The <code>int</code> index of the first ampersand in the source String.\n     * @throws IOException\n     *             when <code>Writer</code> passed throws the exception from calls to the {@link Writer#write(int)}\n     *             methods.\n     */",
    "code": "private void doUnescape(Writer writer, String str, int firstAmp) throws IOException {\n        writer.write(str, 0, firstAmp);\n        int len = str.length();\n        for (int i = firstAmp; i < len; i++) {\n            char c = str.charAt(i);\n            if (c == '&') {\n                int nextIdx = i + 1;\n                int semiColonIdx = str.indexOf(';', nextIdx);\n                if (semiColonIdx == -1) {\n                    writer.write(c);\n                    continue;\n                }\n                int amphersandIdx = str.indexOf('&', i + 1);\n                if (amphersandIdx != -1 && amphersandIdx < semiColonIdx) {\n                    writer.write(c);\n                    continue;\n                }\n                String entityContent = str.substring(nextIdx, semiColonIdx);\n                int entityValue = -1;\n                int entityContentLen = entityContent.length();\n                if (entityContentLen > 0) {\n                    if (entityContent.charAt(0) == '#') { // escaped value content is an integer (decimal or\n                        if (entityContentLen > 1) {\n                            char isHexChar = entityContent.charAt(1);\n                            try {\n                                switch (isHexChar) {\n                                    case 'X' :\n                                    case 'x' : {\n                                        entityValue = Integer.parseInt(entityContent.substring(2), 16);\n                                        break;\n                                    }\n                                    default : {\n                                        entityValue = Integer.parseInt(entityContent.substring(1), 10);\n                                    }\n                                }\n                                if (entityValue > 0xFFFF) {\n                                    entityValue = -1;\n                                }\n                            } catch (NumberFormatException e) {\n                                entityValue = -1;\n                            }\n                        }\n                    } else { // escaped value content is an entity name\n                        entityValue = this.entityValue(entityContent);\n                    }\n                }\n\n                if (entityValue == -1) {\n                    writer.write('&');\n                    writer.write(entityContent);\n                    writer.write(';');\n                } else {\n                    writer.write(entityValue);\n                }\n                i = semiColonIdx; // move index up to the semi-colon\n            } else {\n                writer.write(c);\n            }\n        }\n    }"
  }
]